#!/usr/bin/env python

import boto3
import json
import zlib
from boto3.dynamodb.types import Binary as DynamoBinary

conn = boto3.resource('dynamodb', region_name='us-west-2')
print("Connection established")
table = conn.Table('taar_addon_data_20180206')
print("Got table")
json_payload = json.dumps({
    "scalar_parent_browser_engagement_total_uri_count": 275,
    "city": "Toronto",
    "scalar_parent_browser_engagement_tab_open_event_count": 10,
    "subsession_start_date": "2018-01-15T09:00:00.0+01:00",
    "locale": "en",
    "active_addons": [
        {
            "addon_id": "_ceMembers_@free.easypdfcombine.com",
            "name": "EasyPDFCombine",
            "update_day": 17479,
            "user_disabled": False,
            "is_web_extension": True,
            "has_binary_components": False,
            "signed_state": 2,
            "is_system": False,
            "app_disabled": False,
            "install_day": 17200,
            "version": "8.405.12.16874",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "disable-js-shared-memory@mozilla.org",
            "name": "Disable JavaScript Shared Memory",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "signed_state": 3,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17537,
            "version": "2.0",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "followonsearch@mozilla.com",
            "name": "Follow-on Search Telemetry",
            "update_day": 17486,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17407,
            "version": "0.9.6",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "e10srollout@mozilla.org",
            "name": "Multi-process staged rollout",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 16927,
            "version": "3.05",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "abb@amazon.com",
            "name": "Amazon Assistant for Firefox",
            "update_day": 17493,
            "user_disabled": False,
            "is_web_extension": True,
            "has_binary_components": False,
            "signed_state": 2,
            "is_system": False,
            "app_disabled": False,
            "install_day": 17069,
            "version": "10.1711.15.1405",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": True
        },
        {
            "addon_id": "shield-recipe-client@mozilla.org",
            "name": "Shield Recipe Client",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17407,
            "version": "76.1",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "webcompat@mozilla.org",
            "name": "Web Compat",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17068,
            "version": "1.1",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "activity-stream@mozilla.org",
            "name": "Activity Stream",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17443,
            "version": "2017.11.07.1100-7f4e3634",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "screenshots@mozilla.org",
            "name": "Firefox Screenshots",
            "update_day": 17486,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17331,
            "version": "19.2.0",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "aushelper@mozilla.org",
            "name": "Application Update Service Helper",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17121,
            "version": "2.0",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "formautofill@mozilla.org",
            "name": "Form Autofill",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17443,
            "version": "1.0",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "firefox@getpocket.com",
            "name": "Pocket",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 16927,
            "version": "1.0.5",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "onboarding@mozilla.org",
            "name": "Photon onboarding",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17443,
            "version": "1.0",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        },
        {
            "addon_id": "disable-media-wmf-nv12@mozilla.org",
            "name": "Disable Media WMF NV12 format",
            "update_day": 17537,
            "user_disabled": False,
            "is_web_extension": False,
            "has_binary_components": False,
            "signed_state": 3,
            "is_system": True,
            "app_disabled": False,
            "install_day": 17537,
            "version": "1.1",
            "blocklisted": False,
            "scope": 1,
            "multiprocess_compatible": True,
            "type": "extension",
            "foreign_install": False
        }
    ],
    "subsession_length": 85596,
    "places_bookmarks_count": 35,
    "client_id": "67ad0fa5-af6f-1543-aa9f-0c5bf488f6f9",
    "scalar_parent_browser_engagement_unique_domains_count": 24,
    "os": "Windows_NT",
    "start_date": "20180115"
})

byte_data = json_payload.encode('utf8')
compressed_bytes = zlib.compress(byte_data)

item = {"client_id": "67ad0fa5-af6f-1543-aa9f-0c5bf488f6f9",
        'json_payload': DynamoBinary(compressed_bytes),
        }

print("pre put item")
response = table.put_item(Item=item)
print("post put item")
print(response)
